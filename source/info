Entire source here, all for educational purposes
